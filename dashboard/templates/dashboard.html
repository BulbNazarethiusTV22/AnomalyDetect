<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ IoT-–º–µ—Ä–µ–∂—ñ</title>
	<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 2rem; background-color: #f9f9f9; }
        .attack { background-color: #f8d7da; }
        .normal { background-color: #d1e7dd; }
        .table th, .table td { vertical-align: middle; }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="mb-4">üîç –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ IoT-–∑'—î–¥–Ω–∞–Ω—å</h2>

        <button class="btn btn-primary mb-3" onclick="window.location.href='/download_report'">
            üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–≤—ñ—Ç –ø—Ä–æ –∑–∞–≥—Ä–æ–∑–∏
        </button>

        <table class="table table-bordered table-hover" id="traffic-table">
            <thead class="table-light">
                <tr>
                    <th>–ü—Ä–æ—Ç–æ–∫–æ–ª</th>
                    <th>–ü–æ—Ä—Ç</th>
                    <th>Payload (B/s)</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–†—ñ–≤–µ–Ω—å —Ä–∏–∑–∏–∫—É</th>
                </tr>
            </thead>
            <tbody>
                <!-- –ü–æ—á–∞—Ç–∫–æ–≤–æ —Ç–∞–±–ª–∏—Ü—è –ø–æ—Ä–æ–∂–Ω—è -->
            </tbody>
        </table>

        <p class="text-muted">–ü–æ—Ç—ñ–∫ –¥–∞–Ω–∏—Ö –º–æ–¥–µ–ª—é—î—Ç—å—Å—è —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ ‚Äî –ø–æ –æ–¥–Ω–æ–º—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—é –∫–æ–∂–Ω—ñ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥.</p>
    </div>

    <script>
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B/s';
            const k = 1024;
            const sizes = ['B/s', 'KB/s', 'MB/s', 'GB/s', 'TB/s'];
            const i = Math.floor(Math.log(Math.abs(bytes)) / Math.log(k));
            const val = bytes / Math.pow(k, i);
            return val.toFixed(2) + ' ' + sizes[i];
        }

        const attackAudio = new Audio('/static/kurwa_alarm.mp3');

        function addRandomRow() {
            fetch('/api/data')
                .then(res => res.json())
                .then(data => {
                    const row = document.createElement('tr');
                    row.className = data["–°—Ç–∞—Ç—É—Å"] === "–ê—Ç–∞–∫–∞" ? 'attack' : 'normal';
                    row.innerHTML = `
                        <td>${data["–ü—Ä–æ—Ç–æ–∫–æ–ª"]}</td>
                        <td>${data["–ü–æ—Ä—Ç"]}</td>
                        <td>${formatBytes(data["Payload (B/s)"])}</td>
                        <td><strong>${data["–°—Ç–∞—Ç—É—Å"]}</strong></td>
                        <td>${data["–†—ñ–≤–µ–Ω—å —Ä–∏–∑–∏–∫—É"]}</td>
                    `;
                    const tableBody = document.querySelector("#traffic-table tbody");
                    tableBody.insertBefore(row, tableBody.firstChild);
                    if (tableBody.rows.length > 100) {
                        tableBody.deleteRow(-1);
                    }
                    if (data["–°—Ç–∞—Ç—É—Å"] === "–ê—Ç–∞–∫–∞") {
                        attackAudio.currentTime = 0;
                        attackAudio.play().catch(() => {});
                    }
                })
                .finally(() => {
                    const delay = Math.floor(Math.random() * 1000) + 500;
                    setTimeout(addRandomRow, delay);
                });
        }
        setTimeout(addRandomRow, Math.floor(Math.random() * 1000) + 500);
    </script>
</body>
</html>


